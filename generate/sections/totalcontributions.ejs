<% include ../partials/head.ejs %>

<canvas id="myChart" width="800" height="400"></canvas>

<table id="contributions">
  <thead>
    <tr>
      <th>Position</th>
      <th>City</th>
      <th>Total contributions</th>
    </tr>
  </thead>
</table>


<% include ../partials/scripts.ejs %>
<script src="assets/js/chart.min.js"></script>


<script>
var char;

$(document).ready(function(){
  var cityName;
  var dates;
  var dataset = [];

  var max_cities = 5;

  var position=1;

  $.getJSON( "https://raw.githubusercontent.com/iblancasa/GitHub-DataProcessed-Spain/master/totalContributions.json",
    function( data ) {
      for(i = 0; i < data.length; i++ ){
        cityName = data[i][0];
        date = data[i][1][0];
        date = Object.keys(date)[0];
        position = i+1;

        $("#contributions").
          append("<tr><td>"+position+"</td><td>"+cityName+"</td><td>"+data[i][1][0][date]+"</td></tr>");
      }

      var labels = [];

      for (i = 0; i< data[0][1].length; i++){
         labels.push(Object.keys(data[0][1][i]));
      }

      var data_Contrib=[];

      for (i = 0; i<max_cities;i++){


        for(var contrib in data[i][1]){
          for(var c in data[i][1][contrib]){
            data_Contrib.push(data[i][1][contrib][c]);
          }
        }

        data_Contrib = data_Contrib.reverse();

        dataset.push({
            label: data[i][0],
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: data_Contrib
        });
        data_Contrib=[];
      }


      var data = {
            labels: labels.reverse(),
            datasets: dataset
        };



        var options = {
                ///Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines : true,

                //String - Colour of the grid lines
                scaleGridLineColor : "rgba(0,0,0,.05)",

                //Number - Width of the grid lines
                scaleGridLineWidth : 1,

                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,

                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,

                //Boolean - Whether the line is curved between points
                bezierCurve : true,

                //Number - Tension of the bezier curve between points
                bezierCurveTension : 0.4,

                //Boolean - Whether to show a dot for each point
                pointDot : true,

                //Number - Radius of each point dot in pixels
                pointDotRadius : 4,

                //Number - Pixel width of point dot stroke
                pointDotStrokeWidth : 1,

                //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
                pointHitDetectionRadius : 20,

                //Boolean - Whether to show a stroke for datasets
                datasetStroke : true,

                //Number - Pixel width of dataset stroke
                datasetStrokeWidth : 2,

                //Boolean - Whether to fill the dataset with a colour
                datasetFill : true,

            };
        // Get context with jQuery - using jQuery's .get() method.
        var ctx = $("#myChart").get(0).getContext("2d");

        char = new Chart(ctx).Line(data, options);

    });

});

</script>
<% include ../partials/footer.ejs %>
